{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { defineStore } from 'pinia';\nimport api from '../api';\nexport const useAuth = defineStore({\n  id: 'auth',\n  state: () => ({\n    loggedIn: localStorage.getItem('loggedIn'),\n    token: localStorage.getItem('token'),\n    user: [],\n    validation: [],\n    loginFailed: null,\n    error: null\n  }),\n  actions: {\n    async fetchDataUser() {\n      try {\n        const response = await api.get('/api/user', {\n          headers: {\n            'Authorization': 'Bearer ' + this.token\n          }\n        });\n        this.user = response.data;\n      } catch (err) {\n        this.error = 'Error fetching user data.';\n      }\n    },\n    login(router) {\n      if (this.user.email && this.user.password) {\n        api.get('/sanctum/csrf-cookie').then(response => {\n          api.post('/api/login', {\n            email: this.user.email,\n            password: this.user.password\n          }).then(res => {\n            if (res.data.success) {\n              //set localStorage\n              localStorage.setItem(\"loggedIn\", \"true\");\n\n              //set localStorage Token\n              localStorage.setItem(\"token\", res.data.token);\n\n              //change state\n              this.loggedIn = true;\n\n              //redirect dashboard\n              return router.push({\n                name: 'dashboard'\n              });\n            } else {\n              //set state login failed\n              this.loginFailed = true;\n            }\n          }).catch(error => {\n            console.log(error);\n          });\n        });\n      }\n      this.validation = [];\n      if (!this.user.email) {\n        this.validation.email = true;\n      }\n      if (!this.user.password) {\n        this.validation.password = true;\n      }\n    },\n    logout(router) {\n      api.get('/api/logout').then(() => {\n        localStorage.removeItem('loggedIn');\n        // Redirect using the provided router instance\n        router.push({\n          path: \"/login\"\n        });\n      }).catch(error => {\n        console.error('Error during logout:', error);\n      });\n    }\n  }\n});","map":{"version":3,"names":["defineStore","api","useAuth","id","state","loggedIn","localStorage","getItem","token","user","validation","loginFailed","error","actions","fetchDataUser","response","get","headers","data","err","login","router","email","password","then","post","res","success","setItem","push","name","catch","console","log","logout","removeItem","path"],"sources":["E:/Programming/PROJECT/sm-putra/smputra-frontend/src/store/auth.js"],"sourcesContent":["import { defineStore } from 'pinia';\r\nimport api from '../api';\r\n\r\nexport const useAuth = defineStore({\r\n  id: 'auth',\r\n  state: () => ({\r\n    loggedIn: localStorage.getItem('loggedIn'),\r\n    token: localStorage.getItem('token'),\r\n    user: [],\r\n    validation: [],\r\n    loginFailed: null,\r\n    error: null\r\n  }),\r\n  actions: {\r\n    async fetchDataUser() {\r\n      try {\r\n        const response = await api.get('/api/user', {headers: {'Authorization': 'Bearer '+this.token}})\r\n        this.user = response.data\r\n      } catch (err) {\r\n        this.error = 'Error fetching user data.';\r\n      }\r\n    },\r\n    login(router) {\r\n        if (this.user.email && this.user.password) {\r\n            api.get('/sanctum/csrf-cookie')\r\n                .then(response => {\r\n\r\n                    api.post('/api/login', {\r\n                        email: this.user.email,\r\n                        password: this.user.password\r\n                    }).then(res => {\r\n\r\n                        if (res.data.success) {\r\n\r\n                            //set localStorage\r\n                            localStorage.setItem(\"loggedIn\", \"true\")\r\n\r\n                            //set localStorage Token\r\n                            localStorage.setItem(\"token\", res.data.token)\r\n\r\n                            //change state\r\n                            this.loggedIn = true\r\n\r\n                            //redirect dashboard\r\n                            return router.push({ name: 'dashboard' });\r\n\r\n                        } else {\r\n\r\n                            //set state login failed\r\n                            this.loginFailed = true\r\n\r\n                        }\r\n\r\n                    }).catch(error => {\r\n                        console.log(error)\r\n                    })\r\n\r\n                })\r\n        }\r\n\r\n        this.validation = []\r\n\r\n        if (!this.user.email) {\r\n            this.validation.email = true\r\n        }\r\n\r\n        if (!this.user.password) {\r\n            this.validation.password = true\r\n        }\r\n\r\n    },\r\n    logout(router) {\r\n        api.get('/api/logout')\r\n          .then(() => {\r\n            localStorage.removeItem('loggedIn');\r\n            // Redirect using the provided router instance\r\n            router.push({ path: \"/login\" });\r\n          })\r\n          .catch((error) => {\r\n            console.error('Error during logout:', error);\r\n          });\r\n    },\r\n    },\r\n  },\r\n);\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}